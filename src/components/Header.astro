---
import { Icon } from 'astro-icon/components'; // Ensure you have an icon library installed, e.g., astro-icon
---

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const hamburger = document.querySelector('.hamburger') as HTMLElement;
    const sidebar = document.querySelector('.sidebar-container') as HTMLElement;
    const backgroundSidebar = document.querySelector('.background-sidebar') as HTMLElement;
    const navMenuItems = document.querySelectorAll('.nav-menu-items a') as NodeListOf<HTMLElement>;
    const menuIcon = document.querySelector('.menu-icon') as HTMLElement;
    const chevronIcon = document.querySelector('.chevron-icon') as HTMLElement;

    function toggleSidebar() {
      sidebar.classList.toggle('expanded');
      backgroundSidebar.classList.toggle('visible');
      document.body.classList.toggle('sidebar-open');
      menuIcon.classList.toggle('hidden');
      chevronIcon.classList.toggle('hidden');
    }

    hamburger.addEventListener('click', toggleSidebar);
    backgroundSidebar.addEventListener('click', toggleSidebar);

    navMenuItems.forEach((item) => {
      item.addEventListener('click', toggleSidebar);
    });
  });
</script>

<header>
  <nav class="navbar-container">
    <ol>
      <li aria-label="scroll down to about section">
        <a href="#about">about</a>
      </li>
      <li>
        <a href="#projects" data-astro-prefetch>projects</a>
      </li>
      <li class="navbar-item resume">
        <a href="/resume.pdf" target="_blank" rel="noopener noreferrer">résumé</a>
      </li>
    </ol>
    <li>
      <a class="hit-me-up" href="#" aria-label="mail me section">contact</a>
    </li>
  </nav>
  <div class="hamburger" aria-label="Toggle menu">
    <Icon class="menu-icon visible" name="menu-order" width="40" height="40" />
    <Icon class="chevron-icon hidden" name="chevron-right" width="40" height="40" />
  </div>
  <div class="background-sidebar" aria-label="Close menu"></div>
  <aside class="sidebar-container">
    <div class="navbar">
      <!-- You can add a close icon here if needed -->
    </div>
    <nav class="nav-menu">
      <ul class="nav-menu-items">
        <li class="navbar-child">
          <a href="#about" data-astro-prefetch aria-label="about section">about</a>
        </li>
        <li class="navbar-child">
          <a href="#projects" data-astro-prefetch aria-label="projects section">projects</a>
        </li>
        <li class="navbar-child">
          <a href="/resume.pdf" target="_blank" rel="noopener noreferrer">résumé</a>
        </li>
        <li class="navbar-child">
          <a href="#" aria-label="mail me section">contact</a>
        </li>
      </ul>
    </nav>
  </aside>
</header>

<style>
  .hamburger {
    display: block;
    position: fixed; /* Ensures it stays in place */
    top: 1rem;
    right: 1rem;
    z-index: 20;
    cursor: pointer;
    width: 40px;
    height: 40px;
  }

  .menu-icon,
  .chevron-icon {
    position: absolute;
    top: 0;
    left: 0;
    transition:
      opacity 0.3s ease,
      transform 0.3s ease;
    opacity: 1;
  }

  /* Remove rotation from the hidden class */
  .hidden {
    opacity: 0;
    pointer-events: none;
    /* transform: rotate(180deg); */ /* Removed to fix rotation issue */
  }

  /* Apply rotation when visible */
  .menu-icon.visible {
    transform: rotate(90deg); /* No rotation when visible */
  }

  .chevron-icon.visible {
    transform: rotate(0deg); /* No rotation when visible */
  }

  /* Optional: Add rotation when toggling */
  /* You can customize these values for desired rotation effects */
  .menu-icon.hidden {
    transform: rotate(-90deg);
  }

  .chevron-icon.hidden {
    transform: rotate(90deg);
  }

  header {
    display: flex;
    z-index: 7;
    top: 0;
    width: 100%;
    -moz-box-align: center;
    -moz-box-pack: justify;
    background: none;

    @media (min-width: 50em) {
      height: 80px;
      backdrop-filter: blur(7px);
      -webkit-backdrop-filter: blur(7px);
      -khtml-backdrop-filter: blur(7px);
      -moz-backdrop-filter: blur(7px);
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.04);
    }

    .hamburger {
      /* Ensured hamburger container has a fixed size */
      width: 40px;
      height: 40px;

      svg {
        fill: var(--text-color);
      }
    }
  }

  .navbar-container {
    display: none;
    width: 100%;

    @media (min-width: 50em) {
      display: flex;
      align-self: center;
      background: none;
      transition: var(--transition);

      ol {
        display: flex;
        background: none;
        flex-direction: row;
        justify-content: center;
        gap: 4rem;
        padding: 1px;
      }

      li {
        background: none;
        list-style: none;
        width: fit-content;
        font-size: 1rem;
        transition: var(--transition);
        font-family: 'Messapia Bold', sans-serif;
        text-transform: uppercase;

        &:hover {
          transform: translateY(-3px);
          transition: var(--transition);
        }
      }

      a {
        padding: 0;
        text-decoration: none;
        background: none;
      }
      .hit-me-up {
        right: 0;
        margin-right: 2rem;
      }
    }
  }

  .sidebar-container {
    display: flex;
    position: fixed;
    z-index: 10;
    top: 0;
    right: -70%;
    width: 70%;
    height: 100vh;
    background-color: rgba(30, 30, 30, 0.95);
    transition: right 350ms ease;
    overflow-y: auto;

    @media (min-width: 50em) {
      display: none;
    }

    &.expanded {
      right: 0;
    }
  }

  .background-sidebar {
    position: fixed;
    width: 100%;
    height: 100vh;
    top: 0;
    left: 0;
    z-index: 8;
    background: rgba(0, 0, 0, 0.5);
    opacity: 0;
    visibility: hidden;
    transition:
      opacity 350ms ease,
      visibility 0s linear 350ms;
  }

  .background-sidebar.visible {
    opacity: 1;
    visibility: visible;
    transition: opacity 350ms ease;
  }

  .nav-menu {
    padding: 2rem;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .nav-menu-items {
    list-style-type: none;
    padding: 0;
    margin: 0;
  }

  .navbar-child {
    margin-bottom: 1.5rem;
  }

  .navbar-child a {
    color: var(--text-color);
    text-decoration: none;
    font-size: 1.2rem;
    transition: color 0.3s ease;
  }

  .navbar-child a:hover {
    color: var(--accent-color);
  }

  @media (min-width: 50em) {
    .sidebar-container,
    .background-sidebar,
    .hamburger {
      display: none;
    }
  }

  /* Add this new style */
  body.sidebar-open {
    overflow: hidden;
  }

  /* Ensure the main content can scroll when the sidebar is open */
  main {
    height: 100vh;
    overflow-y: auto;
  }
</style>
